<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Feed</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #f1f5f9;
      margin: 0;
      padding: 0;
    }

    a {
      color: #818cf8;
      text-decoration: none;
    }

    .navbar {
      background: #1e293b;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 24px;
    }

    h1 {
      margin-bottom: 16px;
    }

    /* ===== FILTER BAR ===== */
    .filters {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .filters input,
    .filters select,
    .filters button {
      padding: 8px;
      border-radius: 6px;
      border: none;
    }

    .filters input {
      flex: 1;
    }

    .filters button {
      cursor: pointer;
      background: #6366f1;
      color: white;
    }

    /* ===== POST CARD ===== */
    .post-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .post-content {
      margin-bottom: 12px;
      line-height: 1.6;
    }

    .post-meta {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #94a3b8;
    }

    /* ===== PAGINATION ===== */
    .pagination {
      margin-top: 30px;
      text-align: center;
    }

    .pagination a {
      margin: 0 10px;
    }

    .empty {
      text-align: center;
      margin-top: 40px;
      color: #94a3b8;
    }
  </style>
</head>

<body>

  <!-- ===== NAVBAR ===== -->
  <div class="navbar">
    <div>
      <strong>Social Connect</strong>
    </div>
    <div>
      <a href="/posts/new">Create Post</a> |
      <a href="/logout">Logout</a>
    </div>
  </div>

  <!-- ===== MAIN ===== -->
  <div class="container">
    <h1>Your Feed</h1>

    <!-- ===== SEARCH & SORT ===== -->
    <form method="GET" action="/posts" class="filters">
      <!-- Reset page on new search -->
      <input type="hidden" name="page" value="1" />

      <input
        type="text"
        name="search"
        placeholder="Search posts..."
        value="<%= (query && query.search) ? query.search : '' %>"
      />

      <select name="sortBy">
        <option value="id:DESC"
          <%= query && query.sortBy === 'id:DESC' ? 'selected' : '' %>>
          Newest
        </option>

        <option value="id:ASC"
          <%= query && query.sortBy === 'id:ASC' ? 'selected' : '' %>>
          Oldest
        </option>
      </select>

      <button type="submit">Apply</button>
    </form>

    <!-- ===== POSTS ===== -->
    <% if (!posts || posts.length === 0) { %>
      <div class="empty">
        <p>No posts found.</p>
      </div>
    <% } else { %>
      <% posts.forEach(post => { %>
        <div class="post-card">
          <div class="post-content">
            <%= post.content %>
          </div>

          <div class="post-meta">
            <span>
              ‚ù§Ô∏è <%= post.likeCount || 0 %> |
              üí¨ <%= post.commentCount || 0 %>
            </span>

            <a href="/posts/<%= post.id %>">View</a>
          </div>
        </div>
      <% }) %>
    <% } %>

    <!-- ===== PAGINATION ===== -->
    <% if (meta && meta.totalPages > 1) { %>
      <div class="pagination">

        <% if (meta.currentPage > 1) { %>
          <a href="/posts?page=<%= meta.currentPage - 1 %>&search=<%= encodeURIComponent(query?.search || '') %>&sortBy=<%= encodeURIComponent(query?.sortBy || '') %>">
            ‚¨Ö Prev
          </a>
        <% } %>

        <span>
          Page <%= meta.currentPage %> of <%= meta.totalPages %>
        </span>

        <% if (meta.currentPage < meta.totalPages) { %>
          <a href="/posts?page=<%= meta.currentPage + 1 %>&search=<%= encodeURIComponent(query?.search || '') %>&sortBy=<%= encodeURIComponent(query?.sortBy || '') %>">
            Next ‚û°
          </a>
        <% } %>

      </div>
    <% } %>

  </div>

</body>
</html>
