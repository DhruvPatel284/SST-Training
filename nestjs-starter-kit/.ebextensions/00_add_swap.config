commands:
  01_add_swap:
    command: |
      set -e
      SWAPFILE=/var/swapfile
      SWAP_SIZE=2048
      
      # Check if swap already exists
      if [ -f $SWAPFILE ]; then
        echo "Swap file already exists"
      else
        echo "Creating ${SWAP_SIZE}MB swap file..."
        dd if=/dev/zero of=$SWAPFILE bs=1M count=$SWAP_SIZE
        chmod 600 $SWAPFILE
        mkswap $SWAPFILE
        swapon $SWAPFILE
        echo "$SWAPFILE none swap sw 0 0" >> /etc/fstab
        echo "Swap file created and activated"
      fi
      
      # Verify swap
      swapon -s
      free -h
    test: '[ ! -f /var/swapfile ]'
